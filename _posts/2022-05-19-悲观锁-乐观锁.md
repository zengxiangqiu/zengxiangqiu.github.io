---
title: "悲观锁 乐观锁"
date:  2022-05-19 10:43:24 +0800
categories: [数据库]
tags: [锁]
---

1. 悲观锁

字面意思，假设会发生糟糕的情况，比如脏读、幻读，不可重复读等

独占和排他

数据库层实现，主要分共享锁（S锁）和排他锁（X锁），S锁指多个事务共享，只读不能修改，X锁指独占

2. 乐观锁

不依赖数据库，不上锁，比如数据行中包含version列/时间戳（不是自旋列，会出现ABA问题），每次更新读取比较再替换（CAS， compare and swap），冲突的话就重复读取覆盖，直至成功

1.ABA问题 假设有两个线程——线程1和线程2，两个线程按照顺序进行以下操作：

(1)线程1读取内存中数据为A；
(2)线程2将该数据修改为B；
(3)线程2将该数据修改为A；
(4)线程1对数据进行CAS操作


高并发中，乐观锁限制了性能，通过锁粒度放宽锁的控制

MySQL `for update` 默认行锁，如果没有索引，上升到表锁




[什么是乐观锁，什么是悲观锁](https://www.jianshu.com/p/d2ac26ca6525)
