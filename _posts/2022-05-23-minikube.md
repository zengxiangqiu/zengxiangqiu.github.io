---
title: "minikube"
date:  2022-05-23 14:23:37 +0800
categories: [DevOps]
tags: [kubernetes]
---




[How to Install Minikube on Ubuntu 18.04 / 20.04](https://phoenixnap.com/kb/install-minikube-on-ubuntu)


`minikube start` 出现 permission denied

`sudo groupadd docker`

` sudo usermod -aG docker $USER`

查看 `groups`


更新 ` newgrp docker`


`minikube start --image-repository registry.aliyuncs.com/google_containers  --image-mirror-country='cn' --vm-driver=none  --registry-mirror=https://registry.docker-cn.com --extra-config=kubelet.cgroup-driver=systemd --alsologtostderr --v=5`


`minikube start --image-repository registry.aliyuncs.com/google_containers --image-mirror-country='cn' --base-image="anjone/kicbase" --registry-mirror=https://registry.docker-cn.com  --alsologtostderr --v=8`





## 内网访问面板
`kubectl proxy --port=33493 --address=‘172.21.14.206’ --accept-hosts=’^.*’ &`


kubelet 会在集群中每个节点（node）上运行。 它保证容器（containers）都运行在 Pod 中。

## 镜像

`minikube start  --image-mirror-country='cn' --insecure-registry 172.21.14.206:5000 --v=8`



``` json

docker tag  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.24.1  k8s.gcr.io/kube-apiserver:v1.24.1
docker tag  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.24.1  k8s.gcr.io/kube-proxy:v1.24.1
docker tag  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.24.1  k8s.gcr.io/kube-controller-manager:v1.24.1
docker tag  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.24.1  k8s.gcr.io/kube-scheduler:v1.24.1
docker tag  registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.5.3-0  k8s.gcr.io/etcd:3.5.3-0
docker tag  registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.7 k8s.gcr.io/pause:3.7
docker tag  registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.8.6 k8s.gcr.io/coredns:v1.8.6
docker tag  registry.cn-hangzhou.aliyuncs.com/google_containers/storage-provisioner:v5 k8s.gcr.io/storage-provisioner:v5
docker tag  registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.6 k8s.gcr.io/pause:3.6

```


## 命令

`kubectl  delete  pod,service -l app.kubernetes.io/name=ingress-nginx` 删除 label 相关的pod 和service

`kubectl cordon $NODENAME` 节点设置为不可调度

`kubectl describe node <节点名称>` 查看node

`kubectl get deployments` 查看 deploy

`kubectl describe deployment nginx-deployment` 查看 deploy info

`kubectl get rs` 查看rs，ReplicaSet  = rs

`kubectl rollout status deployment/nginx-deployment` 查看滚动状态

`kubectl rollout history deployment/nginx-deployment` 滚动更新历史

`kubectl rollout undo deployment/nginx-deployment --to-revision=2` 回滚

`kubectl  api-resources  --namespaced` 查看资源,资源缩写，比如 Endpoint = ep, kubectl get ep EndpointName

参考 [kubectl command](https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands)


你需要在集群中的每个节点上都有一个可以正常工作的 容器运行时， 这样 kubelet 能启动 Pod 及其容器 **kubelet 启动 容器**

每个 Pod 都在每个地址族中获得一个唯一的 IP 地址。 Pod 中的每个容器共享网络名字空间，包括 IP 地址和网络端口。 **Pod 内 的容器可以使用 localhost 互相通信**。

Kubernetes 为 Pods 提供自己的 IP 地址，并为一组 Pod 提供相同的 DNS 名， 并且可以在它们之间进行负载均衡服务（Service）将运行在一组 Pods 上的应用程序公开为网络服务的抽象方法。 **Service 为 Pods 负载均衡**

Kubernetes 为该服务分配一个 IP 地址（有时称为 "集群IP"），该 IP 地址由服务代理使用。 **服务IP = 集群IP**

ClusterIP：通过集群的内部 IP 暴露服务，选择该值时服务只能够在集群内部访问。 这也是默认的 ServiceType **只能在集群内部访问对应EndPoint，如果外部访问 type = NodePort**

`kubectl EXPOSE` 服务选择算符的控制器不断扫描与其选择器匹配的 Pod，然后将所有更新发布到也称为 “my-service” 的 Endpoint 对象。 **label selector**

Kubernetes 采用的是中心辐射型（Hub-and-Spoke）API 模式。




